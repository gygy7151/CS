# 인덱스(Index)

## INDEX의 의미

 RDBMS에서 검색속도를 높이기 사용하는 하나의 기술.

- INDEX는 색인입니다. 해당 TABLE의 컬럼을 색인화(따로 파일로 저장)하여 검색시 해당 TABLE의 레코드를 full scan 하는게 아니라 색인화 되어있는 INDEX 파일을 검색하여 검색속도를 빠르게 합니다.

- INDEX는 **TREE구조**로 색인화합니다. RDBMS 에서 사용하는 INDEX는 **Balance Search Tree** 를 사용합니다. **실제로는 RDBMS 에서 사용되는 B-Tree 는 B-Tree 에서 파생된 B+ Tree 를 사용한다고 합니다.** 참고로 ORACLE이나 MSSQL에서는 여러종류의 TREE를 선택하여 사용가능하다.



## INDEX의 원리

- 초기 TABLE생성시 만들어진 MYD,MYI,FRM 3개의 파일중에서 MYI에 해당 컬럼을 색인화 하여 저장합니다. 물론 INDEX를 사용안할시에는 MYI파일은 비어 있습니다.
  - FRM : 테이블 구조 저장 파일
  - MYD : 실제 데이터 파일
  - MYI : Index 정보 파일 (Index 사용 시 생성)
- INDEX를 해당컬럼에 만들게 되면 해당컬럼을 따로 인덱싱하여 MYI 파일에 입력합니다.  그래서 사용자가 SELECT쿼리로 INDEX가 사용하는 쿼리를 사용시 해당 TABLE을 검색하는것이 아니라 빠른 TREE로 정리해둔 MYI파일의 내용을 검색합니다. 만약 INDEX를 사용하지 않은 SEELCT쿼리라면 해당 TABLE full scan하여 모두 검색합니다.

 이는 책의 뒷부분에 찾아보기와 같은 의미로 정리해둔 단어중에서 원하는 단어를 찾아서 페이지수를 보고 쉽게 찾을수 있는 개념과 같습니다. 만약 이 찾아보기 없다면 처음부터 끝까지 모든 페이지를 보고 찾아야 할것입니다.



## INDEX의 장점

- 키 값을 기초로 하여 테이블에서 검색과 정렬 속도를 향상시킵니다.
- 인덱스를 사용하면 테이블 행의 고유성을 화시킬 수 있습니다.
- 테이블의 기본 키는 자동으로 인덱스 됩니다.
- 여러 필드로 이루어진(다중 필드) 인덱스를 사용하면 첫 필드 값이 같은 레코드도 구분할  수 있습니다. 참고로 액세스에서 다중 필드 인덱스는 최대 10개의 필드를 포함할 수 있습니다.




## INDEX의 단점

- 인덱스를 만들면 .mdb 파일 크기가 늘어난다.
  - mdb파일?
     MDB 파일에는 [XML](https://ko.eyewated.com/xml-파일이란-무엇입니까/) 및 [HTML](https://ko.eyewated.com/htm-또는-html-파일이란-무엇입니까/) 과 같은 다른 파일 및 Excel 및 SharePoint와 같은 응용 프로그램의 데이터를 연결하고 저장하는 데 사용할 수있는 데이터베이스 쿼리, 테이블 등이 있습니다.
- 여러 사용자 응용 프로그램에서의 여러 사용자가 한 페이지를 동시에 수정할 수 있는 병행성이 줄어든다.
- 인덱스 된 필드에서 데이터를 업데이트하거나, **레코드를 추가 또는 삭제할 때 성능이 떨어집니다.**
- 데이터 변경 작업이 자주 일어날 경우에 인덱스를 재작성해야 할 필요가 있기에 성능에 영향을 끼칠 수 있다.

 

## INDEX의 목적

RDBMS에는 INDEX가 있습니다. 인덱스의 목적은 해당 RDBMS의 검색 속도를 높이는데 있습니다.
SELECT 쿼리의 WHERE절이나 JOIN 예약어를 사용했을때만 인덱스를 사용되며 SELECT 쿼리의 검색 속도를 빠르게 하는데 목적을 두고 있습니다.
※ DELETE,INSERT,UPDATE쿼리에는 해당 사항없으며 INDEX사용시 좀 느려집니다.




## 상황 분석

- 사용하면 좋은 경우

  (1) Where 절에서 자주 사용되는 Column

  (2) 외래키가 사용되는 Column

  (3) Join에 자주 사용되는 Column

- ##### Index 사용을 피해야 하는 경우

  (1) Data 중복도가 높은 Column

  (2) DML(INSERT / UPDATE / DELETE)이 자주 일어나는 Column

  

##   DML에 취약함 

**ⓐ INSERT**

- index split 현상이 발생할 수 있음.
  **index split: 인덱스의 Block들이 하나에서 두 개로 나누어지는 현상** 
  -> 인덱스는 데이터가 순서대로 정렬 되어야 함. 기존 블록에 여유 공간이 없는 상황에서  그 블록에 새로운 데이터가 입력되어야 할 경우 오라클이 기존 블록의 내용 중 일부를 새 블록에다가 기록한 후 기존 블록에 빈 공간을 만들어서 새로운 데이터를 추가하게 됨.
- **성능면에서 매우 불리** 
  ① index split은 새로운 블록을 할당 받고 key를 옮기는 복잡한 작업을 수행.
  ② index split이 이루어지는 동안 해당 블록에 대해 키 값이 변경되면 안되므로 DML이 블로킹됨.

**ⓑ DELETE**

- 테이블에서 데이터가 delete 될 경우 - 지워지고 다른 데이터가 그 공간을 사용 가능
- index에서 데이터가 delete 될 경우 - **데이터가 지워지지 않고, 사용 안 됨 표시**만 해 둔다.
  -> 즉, 테이블에 데이터가 1만건 있는 경우, 인덱스에는 2만건이 있을 수 있다는 뜻
  -> 인덱스를 사용해도 수행속도를 기대하기 힘들다.



**ⓒ UPDATE**

- **인덱스에는 update 개념이 없다.**
- 테이블에 update가 발생할 경우 인덱스에서는 delete가 먼저 발생한 후 새로운 작업의 insert 작업이 발생한다. **delete와 insert 두 번의 작업이 소요되어 다른 DML보다 더 큰 부하를 주게 됨.



## 면접질문

- DB에서 Index를 사용하는 이유는?
  - 인덱스(Index)는 데이터를 논리적으로 정렬하여 검색과 정렬 작업의 속도를 높이기 위해 사용된다.
  - 예를 들면, 책에서 가장 빨리 내용을 찾는 방법은 책의 뒤편의 색인을 보는 것.
  - 기본키에 대해서는 항상 DBMS가 내부적으로 정렬된 목록을 관리하기에 특정 행을 가져올 때 빠르게 처리된다. 하지만, 다른 열의 내용을 검색하거나 정렬시에는 하나하나 대조를 해보기 때문에 시간이 오래걸린다. (이를 인덱스로 정의해두면 검색속도가 향상된다.)
  - (단점: 인덱스를 사용하면 데이터를 가져오는 작업의 성능은 향상시킬 수 있지만 데이터 삽입, 변경 등이 일어날 때 매번 인덱스가 변경되기 때문에 성능이 떨어질 수 있다.)
  - 사용대상 : 데이터 필터링과 정렬에 사용되므로, 데이터를 특정한 순서로 자주 정렬한다면 인덱스를 사용하기에 적합



---

### Reference

- Index 참고 링크:https://github.com/gyoogle/tech-interview-for-developer/blob/master/Computer%20Science/Database/%5BDB%5D%20Index.md
- Index 참고 링크2:https://rok93.tistory.com/entry/Database-Index%EC%9D%B8%EB%8D%B1%EC%8A%A4?category=879543
- MDB파일?:https://ko.eyewated.com/mdb-%ED%8C%8C%EC%9D%BC%EC%9D%B4%EB%9E%80-%EB%AC%B4%EC%97%87%EC%9E%85%EB%8B%88%EA%B9%8C/
- B-tree: https://hyungjoon6876.github.io/jlog/2018/07/20/btree.html
- 면접질문: https://91ms.tistory.com/2

