# 정규화(Nomalization) & 이상현상(Anomaly)

### 1. 정규화란?

 관계형 데이터베이스의 설계에서 **중복을 최소화하게 데이터를 구조화하는 프로세스**. **함수적 종속성을 이용**해서 연관성 있는 속성들을 분류하고, 각 릴레이션들에서 **이상현상이 생기지 않도록 하는 과정**을 말한다. 정규화 된 정도를 정규형(Normal Form) 으로 표현하는데, 정규형에는 **1NF, 2NF, 3NF, BCNF, 4NF, 5NF, 6NF**까지 있다. 비공식적 표현으로는 3NF가 되었으면 정규화되었다고 말한다.

---

### 2. 정규화의 목적

- **불필요한 데이터를 제거, 데이터 중복을 최소화**

- **무결성 제약조건의 시행을 간단하게 하기 위해서**
- **각종 [이상 현상(Anomaly)](https://wkdtjsgur100.github.io/anomaly)을 방지**하기 위해서, 테이블의 구성을 논리적이고 직관적으로 한다.
- **데이터구조의 안전성 최대화**

---

### 3. 이상현상(Anomaly)

 테이블내의 **데이터 중복성에 의해서 발생되는 데이터 불일치 현상**이다.

1. **갱신이상**: 반복된 데이터 중에 일부를 갱신 할 시 데이터의 불일치가 발생한다.
    아래와 같이 이름이 "홍길동"인 튜플의 주소를 하나만 변경하게 되면, 데이터가 불일치하여 홍길동의 주소를 알 수 없다.

   <img src="https://user-images.githubusercontent.com/71415474/109418173-491f9400-7a0a-11eb-84bd-e166526ea519.png" alt="image-20210228125449290" style="zoom:67%;" />

2. **삽입이상**: 불필요한 정보를 함께 저장하지 않고서는 어떤 정보를 저장하는 것이 불가능하다.
    "이진영" 학생을 DB에 추가하려고 할 때, 이진영 학생은 신입생이라 수강과목, 성적 모두 존재하지 않는다. "수강과목번호" 가 기본키(PK)이므로 null값으로 둘 수 없기 때문에 임의의 값이라도 채워 넣고 데이터를 추가할 수 밖에 없다.

   <img src="https://user-images.githubusercontent.com/71415474/109418177-550b5600-7a0a-11eb-9d0c-cd48127c9c4a.png" alt="image-20210228125744057" style="zoom:67%;" />

3. **삭제이상**: 필요한 정보를 함께 삭제하지 않고서는 어떤 정보를 삭제하는 것이 불가능하다.
    "홍길동" 학생이 수강취소 기간에 수강과목 번호 "0002"의 과목을 취소하였다. 빨간색 데이터를 삭제하면 될 것 같은데 그러면 수강과목번호와 성적 뿐만 아니라 학번, 이름, 나이, 주소 데이터가 모두 같이 사라진다. 지우기를 원치 않는 데이터까지 모두 손실된 것이다.

   <img src="https://user-images.githubusercontent.com/71415474/109418186-5ccafa80-7a0a-11eb-84c0-a973d553d692.png" alt="image-20210228130246718" style="zoom:67%;" />

---

### 4. 함수적 종속성

 함수적 종속이란 어떤 릴레이션 R이 있을때 X와 Y를 각각 속성의 부분집합이라고 가정하자. 여기서 `X의 값을 알면 Y의 값을 바로 식별할 수 있고, X의 값에 Y의 값이 달라질 때`, **Y는 X에 함수적 종속**이라고 합니다. 이 경우 **X를 결정자**, **Y를 종속자**라고 합니다. 이를 기호로 표현하면 **X→Y**입니다.
 아래 릴레이션에서는 **'학번'을 알면 '이름', '나이', '성별' 속성을 식별**할 수 있으며, '학번'이 다르면 그에따른 값도 다릅니다. 따라서 '이름', '나이', '성별' 속성은 '학번'에 함수적인 종속관계입니다

<img src="https://user-images.githubusercontent.com/71415474/109418191-66546280-7a0a-11eb-91df-917ef1ce8afe.png" alt="image-20210228131800151" style="zoom:67%;" />

**1) 완전 함수적 종속(Full Functional Dependency)**

 완전 함수적 종속이란, **종속자가 기본키에만 종속되며**, **기본키가 여러 속성으로 구성되어 있을경우 기본키를 구성하는 모든 속성이 포함된 기본키의 부분집합에 종속된 경우**입니다.
 아래와 같이 기본키가 '고객ID', '상품코드' 속성으로 구성된 릴레이션이 있다. 여기서 '수량 '속성은 기본키인 '고객ID', '상품코드' 속성을 **모두 알아야** 식별 가능하다. 따라서 ''수량'은 '고객ID', '상품코드'에 **완전 함수 종속**된 관계이다.

<img src="C:\Users\oh12s\Desktop\면접스터디\SKILL\Oracle\image\image-20210228132531329.png" alt="image-20210228132531329" style="zoom:67%;" />

**2) 부분 함수적 종속(Partial Functional Dependency)**

 릴레이션에서 **종속자가 기본키가 아닌 다른 속성에 종속되거나, 기본키가 여러 속성으로 구성되어 있을경우 기본키를 구성하는 속성 중 일부만 종속되는 경우**를 말한다.
 기본키가 '고객ID'와 '상품코드' 속성으로 구성된 위의 릴리이션에서서 '주문상품'은 기본키 중 '상품코드'만 알아도 식별할 수 있습니다. 이 경우에는 '주문상품' 속성은 기본키에 **부분 함수 종속**된 관계입니다.

<img src="https://user-images.githubusercontent.com/71415474/109418201-70766100-7a0a-11eb-89f8-3f909559ed07.png" alt="image-20210228132531329" style="zoom:67%;" />

**3) 이행적 함수 종속(Transitive Functional Dependency)**

 삼단논법과 유사하다. X, Y, Z라는 3 개의 속성이 있을 때 **X→Y, Y→Z 이란 종속 관계가 있을 경우, X→Z**가 성립될 때 이행적 함수 종속이라고 한다.

<img src="https://user-images.githubusercontent.com/71415474/109418216-7b30f600-7a0a-11eb-866f-c4b92e2a7fbe.png" alt="image-20210228133047583" style="zoom:67%;" />

 릴레이션에서 '회원번호'를 알면 '이름'을 알 수 있고, '이름'을 알면 '나이'도 알 수 있다. 따라서 '회원번호'를 알면 '나이'를 알 수 있으므로 **이행적 함수 종속** 관계이다.

---

### 5. 제 1 정규형 (1NF: First Normal Form)

 **도메인은 모두 원자값**이어야 합니다. 핸드폰 번호에 2가지가 들어가 있기 때문에 제1 정규형을 만족할 수 없게 된다.** (관계형 데이터 베이스의 경우 기본적으로 도메인은 모두 원자값이기 때문에 제1 정규형은 지켜져 있다)

<img src="https://blog.kakaocdn.net/dn/bIXuX0/btqBGpEhISu/kNCOwnGlgcOJLMP43tiV6k/img.png" alt="img" style="zoom:67%;" />

  테이블을 제1 정규형에 맞춰 수정하면 아래와 같습니다.

<img src="https://blog.kakaocdn.net/dn/cDtHsC/btqBLiXLMaA/e1iuGoGl5Eppp0CP5PAzEk/img.png" alt="img" style="zoom:67%;" />

---

### 6. 제 2 정규형

 제2 정규형은 **부분 함수 종속을 제거**한다. 아래 표에서 학번은 학부와 등록금을 결정할 수 있고, 학번과 과목 코드는 성적을 결졍할 수 있다. 

<img src="https://blog.kakaocdn.net/dn/cmTwvD/btqBHTxUlyE/Wad2A4jpY6pEXfarlh1v91/img.png" alt="img" style="zoom:67%;" />

 함수(학번, 과목코드)에서 **부분 함수인 학번 혼자서 학부와 등록금을 결정할 수 있기 때문에 제2 정규형을 만족할 수 없다.** 따라서 성적, 학부, 등록금에 모두 영향을 주는 학번을 기준으로 릴레이션을 아래와 같이 분리 시킨다.

<img src="https://blog.kakaocdn.net/dn/eNjmkB/btqBGfor6SV/7OcKkFE73Xiw0T9Ylc1nu1/img.png" alt="img" style="zoom:80%;" />

---

### 7. 제 3 정규형

제3 정규형은 **제2정규형을 만족하면서 이행 함수 종속을 제거**한다. 현재 아래 테이블은 학번(X)이 학부(Y)를 결정하고, 학부(Y)가 등록금(Z)을 결정 하고, 이행 규칙에 따라 학번(X)이 등록금(Z)을 결정할 수 있다. (이행 규칙 : X → Y 이고 Y → Z 이면 X → Z 이다.)

현재는 **이행 규칙을 만족하므로 제3 정규형을 만족 시키지 못하며, 이행 함수 종속을 제거해야한다.**

<img src="https://blog.kakaocdn.net/dn/eNjmkB/btqBGfor6SV/7OcKkFE73Xiw0T9Ylc1nu1/img.png" alt="img" style="zoom:80%;" />

 위의 상태에서 갱신 이상이나 여러 문제가 발생할 수 있기 때문에 X → Y, Y → Z 의 형태로 릴레이션을 또 다시 분해 합니다.

<img src="https://blog.kakaocdn.net/dn/SlASz/btqBHTdDoo3/6yv3htZo6k1twifKSUd9MK/img.png" alt="img" style="zoom:80%;" />

---

### 8. 그 외

- BCNF: **제3정규형을 만족하면서** 릴레이션의 **모든 결정자가 후보키**가 되도록 하는 정규형입니다.
- 제 4정규화(4NF): BCNF를 만족하면서 다치 종속 제거
- 제 5정규화(5NF): 조인 종속성 제거

**※ 실무적으로 4, 5 정규화까지는 하지 않는다. 그리고 면접질문 빈도가 가장 높은건 제 3 정규화**

---

### 9. 역정규화

 데이터베이스의 **완벽한 구조설계를 포기**하고 데이터의 **무결성을 떨어트리는** 대신 관계형 데이터베이스의 **읽기(Read)성능 향상을 위한 설계** 방법이다. 컴퓨터는 저 3가지 테이블을 같은 키로 JOIN한 뒤 데이터 값을 찾는다. 만약 테이블 개수가 엄청 많거나 테이블 안에 데이터가 엄청 많으면 JOIN시간이 훨씬 늘어나 **데이터 읽기 효율성**이 떨어진다. 그래서 그림의 **<시간표>**테이블처럼 역정규화 시키면 JOIN을 할 필요가 없어 데이터 **읽기(조회)시간이 단축**된다.

<img src="https://blog.kakaocdn.net/dn/bJUNWP/btqE2twgz5B/Z9qC1T74uCQ1CyAbKnUG60/img.png" alt="img" style="zoom: 67%;" />

---

### 면접 질문



1.  **정규화란?**
    데이터의 중복이나 삽입, 갱신, 삭제시 발생할 수 있는 문제점들을 방지할 수 있도록 무결성을 가지도록 재구성하는것.

    데이터 베이스 설계 단계에서 중복을 최소화하게 데이터를 구조화하는 과정으로 개체(테이블)에 대해 더 이상 분리할 수 없는 상태로 나누는(분리하는)과정을 의미

   

2. **정규화의 목적에 대해 설명하시오.**

   - 불필요한 데이터를 제거, 데이터 중복을 최소화
   - 무결성 제약조건의 시행을 간단하게 하기 위해서
   - 각종 [이상 현상(Anomaly)](https://wkdtjsgur100.github.io/anomaly)을 방지하기 위해서, 테이블의 구성을 논리적이고 직관적으로 한다.
   - 데이터구조의 안전성 최대화
     

3. **제 1 정규화에 대해 설명하시오.**
   모든 속성은 최소 데이터만 입력해야하며 각 테이블에서 중복을 제거해야한다.

4. **각 정규화 단계를 설명해보세요.**

   - 제 1정규화 : 각 컬럼들은 값이 원자값을 가지게 바꾼다.
   - 제 2정규화 : 테이블의 모든 컬럼에서 부분 함수적 종속을 제거하는 것
   - 제 3정규화 : 기본키를 제외한 속성들 간의 이행적 함수 종속을 없애는 것
   - 제 BCNF화 : 결정자이면서 후보키가 아닌 것들 제거
   - 제 4정규화 : 다치 종속 제거
   - 제 5정규화 : 조인 종속성 제거

   

5. **함수적 종속에 대해서 설명하세요.**
    테이블 속성들간의 관계에 대한 제약조건으로 속성A가 속성B를 결정할 때 B는 A에 함수적으로 종속된다고 한다.

6. **완전함수적 종속에 대하여 설명하세요.**
    완전함수적 종속 : 속성들의 집합 X에 대해 Y가 함수적으로 종속될 때, X의 부분집합에 대하여서는 함수적으로 종속되지 않는 경우 Y는 X에 대하여 완전 함수적 종속이라고 한다.

7. **역정규화를 하는 이유는 무엇인가요?**
    정규화를 진행할 수록 하나의 테이블을 여러 테이블로 나누게 되는데, 만약 데이터 호출 시 여러 테이블을 불러서 JOIN을 해줘야한다면 이 비용도 만만치 않기 때문에 역정규화를 한다.



---

### Reference

- https://yaboong.github.io/database/2018/03/09/database-normalization-1/
- https://nirsa.tistory.com/107
- https://dodo000.tistory.com/20
- https://m.blog.naver.com/gluestuck/221711573210
- 역정규화: https://chankim.tistory.com/m/7