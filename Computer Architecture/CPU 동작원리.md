# CPU 동작원리

#### **컴퓨터 구성**

컴퓨터 시스템은 크게 하드웨어와 소프트웨어로 나누어진다.

- **하드웨어** : 컴퓨터를 구성하는 기계적 장치

- **소프트웨어** : 하드웨어의 동작을 지시하고 제어하는 명령어 집합

<br />

#### 하드웨어

- 중앙처리장치(CPU)

- 기억장치 : RAM, HDD

- 입출력 장치 : 마우스, 프린터

  <br />

#### 소프트웨어

- 시스템 소프트웨어 : 운영체제, 컴파일러
- 응용 소프트웨어 : 워드프로세서, 스프레드시트

<br />

#### 컴퓨터 구성요소(하드웨어)

<img width="533" alt="1" src="https://user-images.githubusercontent.com/24764210/108624639-765bc780-7489-11eb-97ad-25df9f2324a0.png">

####  **중앙처리장치(CPU, Central Processing Unit)**

> 사람의 두뇌와 같이 컴퓨터 시스템에 부착된 모든 장치의 동작을 제어하고 명령을 실행하는 장치
>
> 명령어 사이클을 반복해 프로그램을 실행
>
> = 마이크로 프로세서

**1) 산술논리연산장치(ALU : Arithmetic and Logic Unit)**

- **산술**(+, -, x, %) / **논리**(and, or) 연산을 수행하는 장치

- 가산기, 누산기, 보수기, 오버플로 검출기, 상태 레지스터, 데이터 레지스터

   ![산연](https://user-images.githubusercontent.com/24764210/109411266-3c884500-79e4-11eb-8e43-78b64a93fef6.PNG)
   
   <br />

 **2) 제어장치(CU, Control Unit)**

  - 컴퓨터에 있는 모든 장치들의 **동작**을 지시하고 **제어**

  - 프로그램에서 주어진 명령을 **'해석'**하고 이를 **'실행'**하기 위해 제어신호를 만듦

  - 명령 레지스터, 명령 해독기, 제어신호 발생기, 제어주소 레지스터, 제어버퍼 레지스터, 제어기억 장치, 순서 제어 모듈, 순차 카운터

    ![제장](https://user-images.githubusercontent.com/24764210/109411478-c684dd80-79e5-11eb-94cb-8fea1f65a201.PNG)
    
    <br />


  **3) 레지스터(Register)**

  - 고속 기억장치
  
  - CPU 내부에서 처리할 **명령어**나 **연산의 중간 결과값** 등을 일시적으로 기억하는 **임시 기억 장소**

  - 범용 레지스터 : 연산에 필요한 데이터나 연산 결과를 임시로 저장

- 특수목적 레지스터 : 특별한 용도로 사용하는 레지스터

    - PC(프로그램 카운터) : 다음에 수행할 명령어 주소를 저장
    - MAR(메모리 주소 레지스터) : 다음에 실행할 명령어의 주기억장치 주소를 저장
    - MBR(메모리 버퍼 레지스터) : 주기억장치에서 읽어온 데이터 or 저장할 데이터를 임시 저장
    - IR(명령어 레지스터) : 현재 실행 중인 명령어를 임시 저장
    - AC(누산기) : 연산 결과 임시 저장
    - Flag Register (= status register) : 연산 결과의 상태를 나타내는 플래그 비트들로 구성
    - SP (Stack Pointer) : 현재 실행 중인 스레드의 스택 Top의 가상 주소를 저장
    - Count Register : 반복 명령어 사용시 반복 카운터로 사용되는 값을 저장

    <br />


**4) 버스**

- CPU - MEMORY 사이의 정보 전송 통로

   (1) **내부 버스** : CPU 및 메모리 내에 구성된 데이터 전송선

   (2) 외부 버스(= 시스템 버스) : CPU - 주변장치 사이의 정보전송선

   - **주소 버스** (Address Bus)
      	- 기억 장치의 주소 또는 입출력 장치의 포트번호를 지정하고 전달할 때 사용하는 단방향 전송선
     <br />

   - **데이터 버스** (Data Bus)
     - 컴퓨터 구성 요소들 간에 데이터를 전송하는 양방향 전송선
   <br />
     
   - **제어 버스** (Control Bus)
     - 각 구성 요소간 제어 신호를 전달하는 양방향 전송선
     <br />
     <br />

#### **기억장치(Memory)**

> 프로그램, 프로그램 수행에 필요한 명령어와 데이터, 프로그램이 처리한 연산의 중간 결과를 저장하는 장치

**1) 주기억장치**

- 실행 중인 프로그램에 필요한 데이터를 일시적으로 저장

- RAM, ROM

  <br />

**2)보조기억장치**

- 프로그램이 저장되어 있는 곳

- 주기억장치에 비해 속도는 느리지만 많은 자료를 영구적으로 보관

- HDD, SSD

  <br />

#### **입출력장치(I/O Unit)**

> 사용자 또는 컴퓨터 외부에서 데이터를 입력받고 출력하기 위한 장치

**1) 입력 장치**

- 키보드, 마우스

  <br />

**2) 출력 장치**

- 프린터, 모니터, 스피커

<br />

<br />

#### CPU의 동작 과정

![2](https://user-images.githubusercontent.com/24764210/108631657-3f4bdd00-74ae-11eb-8270-fa68e5f9503c.PNG)

1. 주기억장치는 입력장치에서 입력받은 데이터 또는 보조기억장치에 저장된 프로그램 읽어옴
2. CPU는 프로그램을 실행하기 위해 주기억장치에 저장된 프로그램 명령어와 데이터를 읽어와 처리
3. 처리한 결과를 다시 주기억장치에 저장
4. 주기억장치는 처리 결과를 보조기억장치에 저장하거나 출력장치로 보냄
5. 제어장치는 1~3 과정에서 명령어가 순서대로 실행되도록 각 장치를 제어

<br />

<br />

#### CPU 명령어 사이클

> CPU가 주기억장치에서 한번에 하나의 명령어를 인출하여 실행하는데, 인출-실행을 반복하는 사이클 활동
>
> 인출(FETCH) / 해독(DECODE) / 실행(EXECUTE)

![명사](https://user-images.githubusercontent.com/24764210/109410736-6475a980-79e0-11eb-9c7d-8c1cd585ca1e.jpg)

- CPU는 프로그램 실행하기 위해 주기억장치에서 명령어를 순차적으로 인출하여 해독하고 실행하는 과정을 반복.
- 주기억장치의 지정된 주소에서 하나의 명령어를 가져오고, 실행 사이클에서는 명령어를 실행함. 하나의 명령어 실행이 완료되면 그 다음 명령어에 대한 인출 사이클 시작.
- **인출사이클 (기억장치의 지정된 위치로부터 명령어를 읽어오는 과정)** : PC가 가리키는 기억장치의 위치로부터 명령어를 인출해 오고, PC의 값을 1씩 증가시킴으로써 기억장치에 저장되어 있는 명령어들을 순서대로 읽어오는 것.
- **실행 사이클(CPU가 인출된 명령어 코드를 해독하고, 결과에 따라 필요한 연산을 수행하는 과정)** 

<br />

#### 인출 사이클과 실행 사이클에 의한 명령어 처리 과정

![전명사](https://user-images.githubusercontent.com/24764210/109415587-dc51cd00-79fc-11eb-9572-fe7aeef531b4.png)

<br />

<br />

![cpu 동작](https://user-images.githubusercontent.com/24764210/109415799-32734000-79fe-11eb-89f3-964882a83c13.PNG)

> 1 ~ 5 : 인출 사이클, 6 ~ 7 : 실행 사이클

① PC에 저장된 주소를 MAR로 전달

②저장된 내용을 토대로 주기억장치의 해당 주소에서 명령어 인출

③인출한 명령어를 MBR에 저장

④다음 명령어를 인출하기 위해 PC 값 증가시킴

⑤메모리 버퍼 레지스터(MBR)에 저장된 내용을 명령어 레지스터(IR)에 전달

⑥IR로 가져온 명령어를 해독

⑦명령어 실행에 필요한 CPU 제어신호를 발생

<br />

⑴연산장치가 제어장치에서 온 신호를 받습니다

⑵주기억장치에서 데이터 레지스터로 데이터를 저장합니다

⑶누산기의 값과 데이터 레지스터의 값을 가산기가 더합니다

⑷상태 레지스터에 상태를 저장합니다

⑸누산기에 결과 값을 저장합니다

⑹연산이 다 끝나면 주기억장치에 저장합니다.



<br />

<br />

<br />

[자료 출처]

https://dheldh77.tistory.com/category/CS/Computer%20Architecture

https://gamedevlog.tistory.com/m/71

https://coding-factory.tistory.com/351

https://m.blog.naver.com/PostView.nhn?blogId=javrin4&logNo=220994317293&proxyReferer=https:%2F%2Fwww.google.com%2F

https://gamedevlog.tistory.com/69?category=891674

https://wikidocs.net/63816

https://velog.io/@gimtommang11/CPU%EB%A5%BC-%EC%95%8C%EC%95%84%EB%B3%B4%EA%B8%B0