# 프로세스 VS 스레드

> **프로세스** : 메모리에 적재되어 프로세서(CPU)에 의해 실행중인 프로그램
>
> **스레드** : 프로세스 안에서 실행되는 여러 흐름 단위

- 기본적으로 프로세스마다 최소 1개의 스레드(메인 스레드) 가지고 있다. 
- 프로세스는 각각 독립된 메모리 영역(Code, Data, Stack, Heap의 구조)을 할당받는다.
- 한 프로세스가 다른 프로세스의 자원에 접근하려면 프로세스 간의 통신(IPC, inter-process communication)을 사용해야 한다. (Ex. 파이프, 파일, 소켓 등을 이용한 통신 방법 이용)
- 한 프로세스는 다른 프로세스의 변수나 자료구조에 접근할 수 없다.

<br />

[<img src="https://camo.githubusercontent.com/3dc4ad61f03160c310a855a4bd68a9f2a2c9a4c7/68747470733a2f2f74312e6461756d63646e2e6e65742f6366696c652f746973746f72792f393938383931343635433637433330363036" alt="img" style="zoom: 80%;" />](https://camo.githubusercontent.com/3dc4ad61f03160c310a855a4bd68a9f2a2c9a4c7/68747470733a2f2f74312e6461756d63646e2e6e65742f6366696c652f746973746f72792f393938383931343635433637433330363036)

<br />

<img src="https://user-images.githubusercontent.com/24764210/110249305-ece3e380-7fb8-11eb-9ee2-ceb1a3a27b0f.PNG" alt="1" style="zoom: 80%;" />

- Code(정적 메모리 영역) : 프로세서가 실행하는 코드를 저장. 텍스트
- Data(정적 메모리 영역) : 전역변수, 정적변수, 배열 등
  - 초기화 된 데이터는 data 영역에 저장
  - 초기화 되지 않은 데이터는 bss 영역에 저장
- Heap(동적 메모리 영역) : 동적 할당 시 사용 (new(), mallock() 등)
- Stack(동적 메모리 영역) : 정적 할당. 지역변수, 매개변수, 리턴 값과 같은 일시적인 데이터를 저장하는 영역

`정적 메모리` : 메모리 크기가 고정.

`동적 메모리` : 프로그램 실행 중 유동적으로 메모리 크기 조절 가능.

`정적 할당` : 크기를 지정하여 해당 크기만큼의 메모리를 할당받는 것. (= 컴파일 단계) 함수가 사라질 때 자동 반납.

`동적 할당` : 내가 원할때 원하는 크기만큼 메모리를 할당하는 것. (= 실행 단계) 사용자가 원할 때 직접 반납.

<br />

<br />

### 스레드

- 스레드는 Stack만 따로 할당 받고 나머지 영역은 서로 공유
- 하나의 프로세스가 생성될 때, 기본적으로 하나의 스레드 같이 생성
- 스레드 생성 방법 : Runnable 인터페이스를 구현 or Thread 클래스를 상속 -> run() 메소드에 작업 내용 작성

<br />

<br />

### 프로세스와 스레드의 차이?

**프로세스는 운영체제로부터 자신만의 고유 공간과 자원을 할당받아 사용**하는데 반해, **스레드는 프로세스가 할당받은 공간과 자원을 공유하면서 사용**하는 차이가 존재함

<br />

<br />

### 프로세서? 프로세스?

##### 중앙처리장치(CPU) = 프로세서 = 마이크로 프로세서

인간으로 따지면 두뇌에 해당하는 부분

- 주기억장치에서 프로그램 **명령어와 데이터를 읽어와 처리**하고 **명령어의 수행 순서를 제어**.

- 비교와 연산을 담당하는 **산술논리연산장치(ALU)**와 명령어의 해석과 실행을 담당하는 **제어장치**, 속도가 빠른 데이터 기억장소인 **레지스터**로 구성.

- 개인용 컴퓨터와 같은 소형 컴퓨터에서는 CPU를 **마이크로프로세서**라고도 부름

- 하드디스크에 저장되어 있는 **명령어와 데이터의 묶음** 자체는 ''프로그램'', ''프로세스''는 그러한 **프로그램을 실행하여 메모리 상에서 실행되는 작업단위**

- **CPU는 한번에 하나의 프로세스**만 관리

<br />

<br />

<br />

### 멀티프로세스

> 하나의 컴퓨터에 여러 CPU 장착 → 하나 이상의 프로세스들을 동시에 처리(병렬)

**장점** : 안전성 (독립된 구조이기 때문에 메모리 침범 문제를 OS 차원에서 해결)

**단점** : 각각 독립된 메모리 영역을 갖고 있어, 작업량 많을 수록 오버헤드 발생. Context Switching으로 인한 성능 저하

<br />

***Context Switching(문맥교환)\*이란?**

> 하나의 프로세스가 CPU를 사용 중인 상태에서 다른 프로세스가 CPU를 사용하도록 하기 위해, 이전의 프로세스의 상태를 보관하고 새로운 프로세스의 상태를 적재하는 작업
>
> 즉, 동작 중인 프로세스가 대기하면서 해당 프로세스의 상태 정보(context)를 PCB에 보관하고, 대기하고 있던 다음 순번의 프로세스가 동작하면서 이전에 보관했던 프로세스 상태를 복구하는 과정을 말함

- 프로세스는 각 독립된 메모리 영역을 할당받아 사용되므로,  CPU 레지스터 뿐 아니라, RAM과 CPU 사이의 캐시 메모리에 대한 데이터까지 초기화를 하므로 오버헤드가 크다.

  `오버헤드` : 실행시간이나 필요한 메모리 외에 발생하는 시간이나 메모리. 문맥교환에 필요한 시간, 메모리도 오버헤드라고 한다.

<br />

<br />


### 멀티 스레드

> 하나의 응용 프로그램에서 여러 스레드를 구성해 실행시키는 것

스레드들이 공유 메모리를 통해 다수의 작업을 동시에 처리하도록 해줌

독립적인 작업 을 수행해야 하기 때문에 각자의 **스택**과 **PC 레지스터 값**을 갖고 있다

<img src="https://user-images.githubusercontent.com/24764210/110251777-6c77af80-7fc5-11eb-83d2-bbceec305715.png" alt="what_is_thread_1" style="zoom:33%;" />

<br />

**장점** : 적은 메모리 공간을 차지하고 문맥 전환이 빠름. 독립적인 프로세스에 비해 공유 메모리만큼의 시간, 자원 손실이 감소. 전역 변수와 정적 변수에 대한 자료 공유 가능.

**단점** : 안전성 문제. 하나의 스레드가 데이터 공간 망가뜨리면, 모든 스레드가 작동 불능 상태 (공유 메모리를 갖기 때문)

- 멀티스레드의 안전성에 대한 단점은 Critical Section(임계영역) 기법을 통해 대비함

  > 하나의 스레드가 공유 데이터 값을 변경하는 시점에 다른 스레드가 그 값을 읽으려할 때 발생하는 문제를 해결하기 위한 동기화 과정
  >
  > 둘 이상의 스레드가 동시에 접근해서는 안 되는 공유자원의 독점을 보장하는 코드 영역
  > ```
  > 상호 배제, 진행, 한정된 대기를 충족해야함
  > ```
  >
  > - 동기화 : 프로세스 또는 스레드들이 **수행되는 시점을 조절**하는 것





### 멀티 프로세스 대신 멀티 스레드를 사용하는 이유?

하나의 프로세스에서 여러 작업을 동시에 실행하는 **멀티 스레드 방식**이 더 효율적이다.

- 멀티 스레드는 stack을 제외한 메모리를 공유하기 때문에 스레드 간의 자원 공유가 쉽고 빠르다. IPC 통신 같은 복잡한 작업이 필요없어 통신 비용이 줄어든다.
- 멀티 스레드는 문맥 교환 시 stack 영역에 대해서만 처리하면 되기 때문에 작업 부하가 멀티 프로세스에 비해 적다. 멀티 프로세스 방식은 CPU 레지스터 뿐 아니라, RAM과 CPU 사이의 캐시 메모리에 대한 데이터까지 초기화를 해야해서 오버헤드가 더 크다.

<br />

<br />

<br />

<br />

<br />

### Q. 면접질문

#### 프로세스 특징?

- 기본적으로 프로세스마다 최소 1개의 스레드(메인 스레드) 가지고 있다. 
- 프로세스는 각각 독립된 메모리 영역(Code, Data, Stack, Heap의 구조)을 할당받는다.
- 한 프로세스가 다른 프로세스의 자원에 접근하려면 프로세스 간의 통신(IPC, inter-process communication)을 사용해야 한다. (Ex. 파이프, 파일, 소켓 등을 이용한 통신 방법 이용)
- 한 프로세스는 다른 프로세스의 변수나 자료구조에 접근할 수 없다.

<br />

<br />

#### **프로세스와 스레드의 차이?**

프로세스는 운영체제로부터 자신만의 고유 공간과 자원을 할당받아 사용하는데 반해, 스레드는 프로세스가 할당받은 공간과 자원을 공유하면서 사용한다.

<br />

<br />

#### 멀티 프로세스 대신 멀티 스레드를 사용하는 이유?

- 멀티 스레드는 stack을 제외한 메모리를 공유하기 때문에 스레드 간의 자원 공유가 쉽고 빠르다. IPC 통신 같은 복잡한 작업이 필요없어 통신 비용이 줄어든다.
- 멀티 스레드는 문맥 교환 시 stack 영역에 대해서만 처리하면 되기 때문에 작업 부하가 멀티 프로세스에 비해 적다. 반면에 멀티 프로세스 방식은 CPU 레지스터 뿐 아니라, RAM과 CPU 사이의 캐시 메모리에 대한 데이터까지 초기화를 해야해서 오버헤드가 더 크다.

<br />

<br />

#### Context Switching(문맥교환)이란?

하나의 프로세스가 CPU를 사용 중인 상태에서 다른 프로세스가 CPU를 사용하도록 하기 위해, 이전의 프로세스의 상태를 PCB에 보관하고 새로운 프로세스의 상태를 적재하는 작업

<br />

<br />

<br />

[자료 출처]

https://devuna.tistory.com/21

https://doorbw.tistory.com/26

https://m.blog.naver.com/PostView.nhn?blogId=eludien&logNo=221462352935&proxyReferer=https:%2F%2Fwww.google.com%2F

https://haloworld.tistory.com/141