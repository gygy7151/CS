# HTTPS와 공개키

* **HTTP(HyperText Transfer Protocol)**
  * 인터넷 상에서 클라이언트와 서버가 자원을 주고 받을 때 쓰는 통신 규약

* **HTTPS(HyperText Transfer Protocol Secure)**
  * 인터넷 상에서 정보를 암호화하는 `SSL` 프로토콜을 사용해 클라이언트와 서버가 자원을 주고 받을 때 쓰는 통신 규약
  * HTTPS는 텍스트를 공개키 암호화 방식으로 암호화한다.

> 웹사이트에서 로그인을 할 때 HTTP로 정보를 보내면 이 정보를 1) 제 3자가 쉽게 보거나, 2) 해당 웹사이트로 위장한 피싱 문제에 쉽게 노출될 수 있다.
>
> 이와 같은 문제를 HTTPS가 해결할 수 있어 HTTP보다 더 안전하다.
>
> 즉, HTTPS의 핵심 기능은 아래와 같다
>
> 1. 내가 사이트에 보내는 정보들을 제 3자가 못 보게 한다.
> 2. 접속한 사이트가 믿을 만한 곳인지를 알려준다.

<br><br><br><br>

## 대칭키 vs 비대칭키

### 대칭키(Symmetric Key)

* 메시지를 보내는 쪽(암호화)과 메시지를 받는 쪽(복호화)이 같은 암호 방식을 공유하는 방식
* 동일한 키로 주고 받기 때문에, 매우 빠르다는 장점이 있음
* 대칭키 전달 과정에서 해킹 위험 노출

<br>

<img width="1680" alt="스크린샷 2021-04-05 오후 12 10 58" src="https://user-images.githubusercontent.com/46706670/113535301-fd19cd80-960d-11eb-8e9f-9af47df92b9c.png">



키 값이 노출되지만 않는다면 안전하지만, 결국 한 번은 다른 한 쪽에서 다른 한 쪽으로 키를 전송해야 하는데 그 과정에서 키가 노출될 수 있다.

이와 같은 문제를 해결하기 위해 공개키라 불리는 비대칭키 방식이 등장한다.

<br><br><br>

### 비대칭키(= 공개키, Public Key)

* 각 네트워크 참여 주체가 한 쌍을 이루는 두 키를 두어 하나는 개인키, 하나는 공개키로 사용하는 방식
* 암호화와 복호화에 사용하는 암호키를 분리한 알고리즘
* 자신이 가지고 있는 고유한 비밀키로만 복호화할 수 있는 공개키를 대중에 공개함

<br>

##### 공개키 암호화 방식 진행 과정

1. A가 웹 상에 공개된 'B의 공개키'를 이용해 평문을 암호화하여 B에게 보냄
2. B는 자신의 비밀키로 복호화한 평문을 확인, A의 공개키로 응답을 암호화하여 A에개 보냄
3. A는 자신의 비밀키로 암호화된 응답문을 복호화함

**대칭키의 단점을 완벽하게 해결했지만, 암호화 복호화가 매우 복잡함**

(암호화하는 키가 복호화하는 키가 서로 다르기 때문)

<br><br>

<img width="1608" alt="스크린샷 2021-04-05 오후 12 18 21" src="https://user-images.githubusercontent.com/46706670/113535307-0014be00-960e-11eb-93f7-d1d5311da9cf.png">



> 사이트의 공개키로 암호화해 정보를 보내는 과정에서 제 3자가 정보를 탈취해도, 이는 해당 사이트의 개인키로만 복호화할 수 있어 해커가 정보를 해독할 수 없다.

<br><br>

<img width="1635" alt="스크린샷 2021-04-05 오후 12 21 54" src="https://user-images.githubusercontent.com/46706670/113535309-0145eb00-960e-11eb-8752-0615a7116e1f.png">



> 네이버에서 일부 정보를 서버의 개인키로 암호화해 정보를 제공하면, 이는 네이버의 공개키로만 복호화할 수 있다. 만약 정보를 보내온 서버가 네이버가 아니라면 네이버의 공개키로 복호화되지 않기 때문에 가지고 있는 네이버의 **<u>공개키만 검증할 수 있다면</u>** 피싱으로부터 안전하다!

<br><br>

## HTTPS 통신 흐름

1. Client는 Server로 임의의 데이터를 담은 통신 요청을 송신한다.
2. Server는 답변으로 역시 Server측에서 무작위로 생성한 데이터와 자신의 인증서를 송신한다.
3. Client는 브라우저에 내장된 `CA(Certificate Authority)`로 인증서의 진위 여부를 확인한다.
   (CA의 인증을 받은 인증서는 CA의 개인키로 암호화되어 있어 CA의 공개키로 복호화할 수 있다.)
4. 성공적으로 인증받은 Server의 공개키를 확인하면, Client는 해당 Server를 신뢰하고 **이후 대칭키와 비대칭키를 혼합해 사용한다**. 
   (모든 데이터를 비대칭키로만 주고 받는 경우 과도한 부하가 발생하기 때문 -> `SSL`)
5. 먼저 대칭키를 생성하여 비대칭키로 주고 받아 안전하게 대칭키를 Server와 브라우저만 공유하는 대칭키를 설정한다.
6. 데이터를 대칭키를 사용해 암호화/복호화하며 데이터를 주고 받는다.

<br><br>

##### 대칭키와 공개키 암호화 방식을 적절히 혼합한 방식? -> SSL의 기초

> SSL 탄생의 시초가 됨

```
1. A가 B의 공개키로 암호화 통신에 사용할 대칭키를 암호화하고 B에게 보냄
2. B는 암호문을 받고, 자신의 비밀키로 복호화함
3. B는 A로부터 얻은 대칭키로 A에게 보낼 평문을 암호화하여 A에게 보냄
4. A는 자신의 대칭키로 암호문을 복호화함
5. 앞으로 이 대칭키로 암호화를 통신함
```

즉, 대칭키를 주고받을 때만 공개키 암호화 방식을 사용하고 이후에는 계속 대칭키 암호화 방식으로 통신하는 것!

<br><br><br><br>

## Quiz

* HTTP와 HTTPS의 차이는 무엇인가요?
* HTTPS가 동작하는 방식에 대해서 설명해주세요.

<br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br>

# 참고 자료

* [신입 개발자 전공 지식 & 기술 면접 백과사전: 대칭키 & 공개키, HTTP & HTTPS](https://github.com/gyoogle/tech-interview-for-developer/blob/master/Computer%20Science/Network/HTTP%20%26%20HTTPS.md)
* [HTTPS가 뭐고 왜 쓰나요? - 얄팍한 코딩사전(Youtube)](https://www.youtube.com/watch?v=H6lpFRpyl14)
* [신입 웹개발자 기술면접(네트워크)](https://ryugaram.tistory.com/45)



## Quiz 답안

* HTTP와 HTTPS의 차이는 무엇인가요?

데이터를 주고 받는 과정에 보안 요소 추가 s의 차이가 secure, 공개키 암호화

HTTPS: SSL 프로토콜 이용하여 웹브라우저와 서버가 데이터를 주고받는 통신 규약



* HTTPS가 동작하는 방식에 대해서 설명해주세요.

> * Client는 Server로 임의의 데이터를 담은 통신 요청을 송신한다.
> * Server는 답변으로 역시 Server측에서 무작위로 생성한 데이터와 자신의 인증서를 송신한다.
> * Client는 브라우저에 내장된 `CA(Certificate Authority)`로 인증서의 진위 여부를 확인한다.
>   (CA의 인증을 받은 인증서는 CA의 개인키로 암호화되어 있어 CA의 공개키로 복호화할 수 있다.)
> * 성공적으로 인증받은 Server의 공개키를 확인하면, Client는 해당 Server를 신뢰하고 **이후 대칭키와 비대칭키를 혼합해 사용한다**. 
>   (모든 데이터를 비대칭키로만 주고 받는 경우 과도한 부하가 발생하기 때문 -> `SSL`)
> * 먼저 대칭키를 생성하여 비대칭키로 주고 받아 안전하게 대칭키를 Server와 브라우저만 공유하는 대칭키를 설정한다.
> * 데이터를 대칭키를 사용해 암호화/복호화하며 데이터를 주고 받는다.

